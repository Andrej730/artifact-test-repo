name: macOS Yacc Availability Check

on:
  workflow_dispatch:

jobs:
  check-yacc-on-macos:
    runs-on: macos-13
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Update Homebrew
      run: brew update
      
    - name: ccache
      uses: hendrikmuhs/ccache-action@v1.2
      with:
        key: mac-${{ runner.arch }}
      
    - name: BEFORE - Check yacc availability
      run: |
        echo "üîç === BEFORE INSTALLING DEPENDENCIES ==="
        echo "=== yacc availability check ==="
        if command -v yacc >/dev/null 2>&1; then
          echo "‚úÖ yacc is available in PATH"
          echo "yacc version: $(yacc --version 2>&1 | head -1 || echo 'version not available')"
          echo "yacc location: $(which yacc)"
        else
          echo "‚ùå yacc is NOT available in PATH"
        fi
        echo ""
        
    - name: Install dependencies via Homebrew
      run: |
        echo "=== Installing dependencies ==="
        brew update
        brew install git bison autoconf automake libffi findutils
        echo "Installation completed"
        echo ""
        
    - name: AFTER - Check yacc availability after brew installs
      run: |
        echo "üîç === AFTER INSTALLING DEPENDENCIES ==="
        echo "=== yacc availability check ==="
        if command -v yacc >/dev/null 2>&1; then
          echo "‚úÖ yacc is available in PATH"
          echo "yacc version: $(yacc --version 2>&1 | head -1 || echo 'version not available')"
          echo "yacc location: $(which yacc)"
        else
          echo "‚ùå yacc is NOT available in PATH"
        fi
        echo ""